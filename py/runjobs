#! /usr/bin/python 

#********************************************************************
#     Author: Liang Men                                             *
#
# This is the Main function for the python scripts generated by the 
# PEAK website.For execution, the main directory contianing the
# numerical function directories is required. For compilation with 
# ACML and MKL, the reference directories are required by ACMLDIR 
# and MKLDIR variables. 
#  
#********************************************************************


import os, sys, re, commands, pprint, glob, shutil, compilejobs, cleanjobs, executejobs
from string import Template

def main():

   default_main_dir = os.getcwd() + '/LAB'
   set_main_path = raw_input("Enter the main path [Default is " + default_main_dir +" ]:")
   if set_main_path == '':
	main_dir = default_main_dir
   else:
	main_dir = set_main_path

   if not os.path.isdir(main_dir):
	print "program exits for failing to find the directory " + main_dir
	sys.exit()

   default_acml_dir = '/opt/acml/4.4.0'
   set_acml_path = raw_input("Enter the ACML library path [Default is " + default_acml_dir +" ]:")
   if set_acml_path == '':
	ACMLDIR = default_acml_dir
   else:
	ACMLDIR = set_acml_path

   if not os.path.isdir(ACMLDIR):
	print "program exits for failing to find the directory " + ACMLDIR
	sys.exit()

   default_intel_dir = '/opt/intel/Compiler/11.1/038'
   set_intel_path = raw_input("Enter the MKL library path [Default is " + default_intel_dir +" ]:")
   if set_intel_path == '':
	MKLDIR = default_intel_dir
   else:
	MKLDIR = set_intel_path

   if not os.path.isdir(MKLDIR):
	print "program exits for failing to find the directory " + MKLDIR
	sys.exit()


   allib = ['mkl', 'acml', 'libsci', ]
   allcompiler = ['intel', 'gnu', 'pgi', ]

   compile_dirs = []

   routine_params = []
   for i in compile_dirs:
	routine = i + "parm"
	routine_params.append(eval(routine))

   cleanjobs.clean_jobs (main_dir, compile_dirs, allib, allcompiler)
   compilejobs.compile_jobs (main_dir, compile_dirs, allib, allcompiler, ACMLDIR, MKLDIR)
   executejobs.execute_jobs (main_dir, compile_dirs, allib, allcompiler, routine_params)



if __name__ == "__main__":
	main()